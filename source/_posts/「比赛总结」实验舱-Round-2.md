---
title: 「比赛总结」实验舱 Round 2
date: 2021-03-10 14:48:30
password: flstxdy!
tags:
 - dp
 - 数据结构
 - 字符串
 - 容斥原理
 - 背包
 - 排序不等式
categories:
 - 比赛总结
---

有一道平衡树优化 dp 转移的题目，比较有意思。

<!-- more -->

[A](/pdf/20210310/A.pdf)

[B](/pdf/20210310/A.pdf)

## [C. 最大价值](/pdf/20210310/C.pdf)

A 君有 $n$ 个物品，每个物品有两个属性 $a_i,b_i$，现在 A 君想从所有物品中挑选 $k$ 个，并按一定顺序摆放好。

对于一个方案中，被摆在第 $j$ 个位置（位置从 $1$ 开始标号）的物品为 $i$，它对这个方案产生的价值贡献为 $a_i\cdot(j-1)+b_i$，一个方案的价值和为它所含的所有物品的贡献之和。

现在 A 君想知道对于所有可能的 $k$（$1\le k\le n​$），在最优的选取以及摆放情况下能得到的方案价值和最大是多少。

接下来 $n$ 行，每行两个整数 $a_i, b_i$。

$100\%$ 的数据：$n \le 300\,000$, $0 \le a_i \le 10^6$, $0 \le b_i \le 10^{12}$

输出 $n$ 行，每行两个整数 $a_i, b_i$ ，表示 $k=1, 2, 3, 4, \cdots , n$ 时的最大总价值。

对于一个大小为 $k$ 的方案，如果确定了选择哪 $k$ 个，就可以直接按照 $a$ 排序，然后依次算出贡献（排序不等式）

那么显然可以考虑先对原物品按照的 $a$ 排序，然后依次做背包即可。
$$
dp[i][j] = \max\{dp[i-1][j], dp[i-1][j-1] + a_i\times j+b_i\}
$$
观察到一条结论，选定 $k$ 个物品的答案，一定是在原来 $k-1$ 个物品的答案基础上添加一个物品，而不会拿走。

如果考虑了 $i$ 种物品，那么对于选取 $j$ 个物品的方案，一定是从选 $j-1$ 个物品的方案添加一个物品得到的。也就是说，每新考虑一个物品，上面的转移一定是在某个 $j$ 之前都是继承上一轮的答案，之后都是新增这个物品的答案，维护差分数组即可。可以平衡数维护每一个 $j$ 处的答案的差分。

官方题解附有结论证明。
