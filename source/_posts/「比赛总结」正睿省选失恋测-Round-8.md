---
title: 「比赛总结」正睿省选失恋测 Round 8
date: 2021-03-10 07:43:18
password: flstxdy!
tags:
 - 数学
 - 线性基
 - 博弈论
 - 矩阵
 - 树链剖分
 - 生成函数
 - 计数
 - 字符串
 - AC自动机
 - 题解
categories:
 - 比赛总结
---

正睿十连测 Round 8 补题记录。 菜到去世……

<!-- more -->

## 陈太阳的石子游戏
有 $n$ 堆石子，每堆石子被染成了黑色或者白色，第 $i$ 堆石子有 $a_i$ 个石子。陈太阳和杨主力轮流操作，杨主力先操作。操作有两种，他们每次可以选择一种进行操作：
 - 从石子数量最少的黑堆中取出任意正整数数量的石头
 - 从任何白堆中取出任意正整数数量的石头

不能操作的玩家将会输掉游戏。现在所有石头堆都是固定的，但尚未着色。 陈太阳贿赂了裁判，使他有机会自己给所有石头涂色。 现在，他想知道有多少种涂色方法使得自己能赢下游戏？ 由于答案可能太大，因此只需要输出模 $1 000 000 007$ 答案即可。 

好吧 - -这才明白什么叫做 `SG` 函数。

### Sprague-Grundy(SG)定理
对于一个完整的游戏局面 $G$ ，有若干个子游戏 $G_0, G_1, G_2, \cdots$ 那么：
$$
\operatorname{SG}(G) = \bigoplus\limits{G_i}
$$
对于一个局面 $x$ ，若其有若干个后继局面，则：
$$
\operatorname{SG}(x) = \operatorname{mex}\{ \operatorname{SG}(y) \mid y \text{是} x \text{后继} \}
$$
 特殊地，若一个局面 $P$ 没有后继局面，则其 $\operatorname{SG}$ 值为 $0$。

首先考虑必胜局面条件是什么：

对一个局面划分子游戏，显然，白色石头和黑色石头可以作为两个子游戏，白色石头构成一个经典的 `Nim` 游戏。只需要考虑黑色石头的 $\operatorname{SG}$ 值即可。

通过手算不难发现黑色石头的 $\operatorname{SG}$ 值为：
$$
\text{最小堆中的石头数}-(\text{最小堆的数量}+[\text{所有黑色石头堆都具有相同的大小}]) \% 2
$$
先按照石子数量排序。

可以考虑枚举最小堆出现次数和石子数量 $x$，石子数量小于 $x$ 的石子堆一定是白色堆，枚举一个出现次数，可以算出石子数量等于 $x$ 和小于 $x$ 的堆的 $\operatorname{SG}$ 值 $z$，然后考虑后面的石子堆有多少种选法，使得其 $\operatorname{SG}$ 值等于 $z$ 即可。这个问题是 [线性基](https://shuyumo2003.github.io/%E3%80%8C%E7%90%90%E8%AE%B0%E3%80%8D%E8%B4%B0%E6%9C%88-%E5%8F%81%E6%9C%88-%E7%90%90%E8%AE%B0/#%E7%BA%BF%E6%80%A7%E5%9F%BA%E7%90%90%E8%AE%B0) 的经典问题。

